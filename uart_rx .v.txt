module uart_rx (
    input  wire       clk,
    input  wire       reset,
    input  wire       baud_tick,
    input  wire       rx,
    output reg [7:0]  rx_data,
    output reg        rx_done
);

    reg [3:0] bit_count;
    reg [7:0] data_reg;
    reg       receiving;

    always @(posedge clk or posedge reset) begin
        if (reset) begin
            bit_count <= 0;
            data_reg  <= 0;
            rx_data   <= 0;
            rx_done   <= 0;
            receiving <= 0;
        end else begin
            rx_done <= 0;

            if (!receiving) begin
                if (rx == 0) begin
                    receiving <= 1;
                    bit_count <= 0;
                end
            end else begin
                if (baud_tick) begin
                    bit_count <= bit_count + 1;

                    if (bit_count >= 1 && bit_count <= 8) begin
                        data_reg[bit_count-1] <= rx;
                    end

                    if (bit_count == 9) begin
                        rx_data   <= data_reg;
                        rx_done   <= 1;
                        receiving <= 0;
                    end
                end
            end
        end
    end

endmodule
